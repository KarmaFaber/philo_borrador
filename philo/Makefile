#â—‰â”€â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Colors:   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

BLACK   := \033[0;30m
RED     := \033[0;31m
GREEN   := \033[0;32m
YELLOW  := \033[0;33m
BLUE    := \033[0;34m
MAGENTA := \033[0;35m
CYAN    := \033[0;36m

CURRENT_COLOR := \033[0;34m
RESET   := \033[0m


#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Variables:   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

NAME        := philo
CC          := cc
CFLAGS      := -Wall -Werror -Wextra 
RM          := rm -rf

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Formatting:   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

# Run 'make re MODE=pretty' for color formatting.
# Run 'make re MODE=debug' for debug formatting.

MODE	= none

ifeq ($(MODE), pretty)
	CFLAGS	+= -D DEBUG_FORMATTING=1
endif

ifeq ($(MODE), debug)
	CFLAGS	+= -D DEBUG_FORMATTING=1 -fsanitize=thread -g
endif

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢    philo srcs:   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

PHILO_SRCS  := main.c parce.c utils.c exit.c
PHILO_OBJS  := $(PHILO_SRCS:.c=.o)

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢     rules      â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

all: $(NAME)

$(NAME): $(PHILO_OBJS) 
	@$(CC) $(CFLAGS) $(PHILO_OBJS) -o $(NAME)
	@echo "$(CURRENT_COLOR) âœ… $(NAME) created.\n$(RESET)"

%.o: %.c
	$(CC) $(CFLAGS) -lpthread -c $< -o $@

clean:
	$(RM) $(PHILO_OBJS)
	@echo "$(CURRENT_COLOR)ğŸ§¹ Object files cleaned.\n$(RESET)"

fclean: clean
	$(RM) $(NAME)
	@echo "$(CURRENT_COLOR) ğŸ§¹ $(NAME) binary cleaned.\n$(RESET)"

re: fclean all

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Valgrind   â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

VALGRIND := valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes --error-limit=no --log-file=test/valgrind_outputs/valgrind_output_$(shell date +%Y%m%d_%H%M%S).log -s

valgrind: all

	@echo "$(CURRENT_COLOR)âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€Running Valgrind..â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€$(RESET)"
#	@-$(VALGRIND) ./$(NAME) <number_of_philosophers> <time_to_die> <time_to_eat> <time_to_sleep> [number_of_times_each_philo_must_eat]
#	@-$(VALGRIND) ./$(NAME) 
	@-$(VALGRIND) ./$(NAME) 4 800 200 200 5
	@test/hs_files/./open_valgrind_log.sh
	@echo "$(CURRENT_COLOR)âµâ¤â•Œâ•Œâ£â‹†â£â•Œâ”€â¤âµâ€¢âµâ¤â”€â•Œâ•Œâ£â‹†â£â”€â”€ Valgrind completed. Check valgrind_output.log for details. â”€â•Œâ£â‹†â£â•Œâ”€â¤âµâ€¢âµâ¤â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€$(RESET)"
	
clean_valgrind:
	test/hs_files/./clean_valgrind.sh

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢   Test    â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

test: all
	@echo "$(CURRENT_COLOR)âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€ Starting test: â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”$(RESET)"
	@test/hs_files/./test_philo.sh
	@echo "$(CURRENT_COLOR)âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€ End of test. â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”$(RESET)"

clean_test:
	test/hs_files/./clean_test.sh

clean_all: clean_test fclean clean_valgrind
	
#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢ Norminette â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

norm:
	@echo "$(CURRENT_COLOR)âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€ Checking Norminette: â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”$(RESET)"
	@norminette $(PHILO_SRCS) philo.h
	@echo "$(CURRENT_COLOR)âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€â¤âµâ€¢âµâ¤â”€â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€â”€ Norminette completed. Check your output for details. â”€â•Œâ£â‹†â£â•Œâ”€â¤âµâ€¢âµâ¤â”€â•Œâ•Œâ£â‹†â£â•Œâ•Œâ”€$(RESET)"

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢  Format â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

format: 
	c_formatter_42 $(PHILO_SRCS) philo.h

#â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢ Phony targets â–¢â”€â”€â”€â–£â”€â”€â”€â—‰â€¢â—‰â”€â”€â”€â–£â”€â”€â”€â–¢â—‡â–¢â”€â”€â”€â–£â”€â”€â”€â—‰#

.PHONY: all clean fclean re format norm valgrind test clean_valgrind clean_test clean_all